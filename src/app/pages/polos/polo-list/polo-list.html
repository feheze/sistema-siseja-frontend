<div class="polo-list-container">
  <mat-toolbar color="primary">
    <mat-icon>location_city</mat-icon>
    <span>Lista de Polos</span>
    <span class="spacer"></span>
    <button mat-icon-button routerLink="/polos/new" matTooltip="Novo Polo">
      <mat-icon>add</mat-icon>
    </button>
  </mat-toolbar>
  
  <!-- Filtros -->
  <mat-card class="filter-card">
    <mat-card-header>
      <mat-icon mat-card-avatar>filter_list</mat-icon>
      <mat-card-title>Filtros</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="filter-actions">
        <button mat-raised-button color="primary" (click)="loadAllPolos()"
                [class.active]="filterType() === 'all'">
          <mat-icon>list</mat-icon>
          Todos os Polos
        </button>
        
        <button mat-raised-button color="accent" (click)="loadActivePolos()"
                [class.active]="filterType() === 'active'">
          <mat-icon>check_circle</mat-icon>
          Apenas Ativos
        </button>
        
        <form [formGroup]="filterForm" class="filter-form">
          <mat-form-field appearance="outline">
            <mat-label>Filtrar por Estado</mat-label>
            <mat-select formControlName="estado">
              @for (estado of estados; track estado) {
                <mat-option [value]="estado">{{ estado }}</mat-option>
              }
            </mat-select>
          </mat-form-field>
          
          <button mat-raised-button color="warn" type="button" (click)="loadPolosByEstado()"
                  [disabled]="!filterForm.get('estado')?.value">
            <mat-icon>filter_list</mat-icon>
            Filtrar
          </button>
        </form>
      </div>
      
      <!-- Current filter indicator -->
      @if (filterType() !== 'all') {
        <div class="filter-indicators">
          @if (filterType() === 'active') {
            <mat-chip-set>
              <mat-chip highlighted>
                <mat-icon matChipAvatar>check_circle</mat-icon>
                Exibindo apenas polos ativos
              </mat-chip>
            </mat-chip-set>
          }
          @if (filterType() === 'byState') {
            <mat-chip-set>
              <mat-chip highlighted>
                <mat-icon matChipAvatar>place</mat-icon>
                Filtrado por estado: {{ filterForm.get('estado')?.value }}
              </mat-chip>
            </mat-chip-set>
          }
        </div>
      }
    </mat-card-content>
  </mat-card>

  @if (isLoading()) {
    <div class="loading-container">
      <mat-progress-spinner mode="indeterminate" />
      <p>Carregando polos...</p>
    </div>
  } @else if (error()) {
    <mat-card class="error-card">
      <mat-card-content>
        <mat-icon color="warn">error</mat-icon>
        <p>Erro ao carregar polos: {{ error() }}</p>
        <button mat-raised-button color="primary" (click)="loadAllPolos()">
          <mat-icon>refresh</mat-icon>
          Tentar Novamente
        </button>
      </mat-card-content>
    </mat-card>
  } @else if (polos().length > 0) {
    <!-- Grid responsivo de polos -->
    <div class="polos-grid">
      @for (polo of polos(); track polo.id) {
        <mat-card class="polo-card" [class.inactive]="!polo.ativo">
          <mat-card-header>
            <mat-icon mat-card-avatar [class.inactive-icon]="!polo.ativo">
              {{ polo.ativo ? 'location_city' : 'location_off' }}
            </mat-icon>
            <mat-card-title>{{ polo.nome }}</mat-card-title>
            <mat-card-subtitle>{{ polo.cidade }} - {{ polo.estado }}</mat-card-subtitle>
          </mat-card-header>

          <mat-card-content>
            <div class="polo-info">
              <div class="info-item">
                <mat-icon>person</mat-icon>
                <span><strong>Coordenador:</strong> {{ polo.coordenador }}</span>
              </div>
              <div class="info-item">
                <mat-icon>groups</mat-icon>
                <span><strong>Capacidade:</strong> {{ polo.capacidadeMaxima }} alunos</span>
              </div>
              <div class="info-item">
                <mat-icon [class.status-active]="polo.ativo" [class.status-inactive]="!polo.ativo">
                  {{ polo.ativo ? 'check_circle' : 'cancel' }}
                </mat-icon>
                <span [class.status-active]="polo.ativo" [class.status-inactive]="!polo.ativo">
                  <strong>Status:</strong> {{ polo.ativo ? 'Ativo' : 'Inativo' }}
                </span>
              </div>
            </div>
          </mat-card-content>

          <mat-card-actions>
            <button mat-button color="primary" [routerLink]="['/polos', polo.id]">
              <mat-icon>visibility</mat-icon>
              Detalhes
            </button>
            <button mat-button color="accent" [routerLink]="['/polos/edit', polo.id]">
              <mat-icon>edit</mat-icon>
              Editar
            </button>
            <button mat-button color="warn" (click)="deletePolo(polo.id)">
              <mat-icon>delete</mat-icon>
              Excluir
            </button>
          </mat-card-actions>
        </mat-card>
      }
    </div>
  } @else {
    <!-- Estado vazio -->
    <mat-card class="empty-state">
      <mat-card-content>
        <div class="empty-content">
          <mat-icon>location_off</mat-icon>
          <h2>Nenhum Polo Encontrado</h2>
          <p>Não há polos cadastrados ou que atendam aos filtros selecionados.</p>
          <button mat-raised-button color="primary" routerLink="/polos/new">
            <mat-icon>add</mat-icon>
            Cadastrar Primeiro Polo
          </button>
        </div>
      </mat-card-content>
    </mat-card>
  }
</div>
